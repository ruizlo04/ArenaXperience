<app-navbar-principal></app-navbar-principal>

<div class="profile-container">
  <h2 class="profile-list-title">Perfiles del Sistema</h2>

  <button class="reload-btn mb-4" (click)="loadAllUsers(currentPage)">Recargar Perfiles</button>

  <div *ngIf="loadingUsers" class="loading-text">Cargando usuarios...</div>
  <div *ngIf="usersError" class="error-text">{{ usersError }}</div>

  <div *ngIf="!editedUser" class="profile-card">
    <div *ngFor="let user of allUsers" class="user-card">
      <h3>{{ user.username }}</h3>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><strong>Teléfono:</strong> {{ user.phoneNumber }}</p>

      <button class="btn-edit-event" (click)="startEditUser(user)" aria-label="Editar usuario" title="Editar usuario">
        <i class="bi bi-pencil-fill" style="font-size: 1.2rem;"></i>
      </button>
    </div>

    <div *ngIf="!loadingUsers && allUsers.length === 0" class="loading-text">
      No hay usuarios registrados.
    </div>
  </div>

  <div *ngIf="editedUser" class="edit-user-form">
    <h2>Editar Usuario: {{ editedUser.username }}</h2>

    <form (ngSubmit)="saveEditedUser()" class="form-grid">
      <label>Email</label>
      <input type="email" [(ngModel)]="editedUser.email" name="email" required />

      <label>Confirmar Email</label>
      <input type="email" [(ngModel)]="editedUser.verifyEmail" name="verifyEmail" required />

      <label>Teléfono</label>
      <input type="text" [(ngModel)]="editedUser.phoneNumber" name="phoneNumber" required />

      <label>Nueva Contraseña (opcional)</label>
      <input type="password" [(ngModel)]="editedUser.password" name="password" />

      <label>Confirmar Contraseña</label>
      <input type="password" [(ngModel)]="editedUser.verifyPassword" name="verifyPassword" />

      <div class="form-buttons">
        <button type="submit" class="btn-save">Guardar Cambios</button>
        <button type="button" class="btn-cancel" (click)="cancelEdit()">Cancelar</button>
      </div>
    </form>
  </div>

  <div class="pagination-container" *ngIf="!editedUser && totalPages > 1">
    <button class="pagination-btn" [disabled]="currentPage === 0" (click)="goToPage(currentPage - 1)">Anterior</button>
    <span class="pagination-info">Página {{ currentPage + 1 }} de {{ totalPages }}</span>
    <button class="pagination-btn" [disabled]="currentPage === totalPages - 1" (click)="goToPage(currentPage + 1)">Siguiente</button>
  </div>
</div>
